// C. Bonnington
// Ski Timer
// version 26 Feb, 2023
//-------------------------------------------


// initial configurations
//-------------------------------------------
#include <LiquidCrystal.h>

#define gate 11 // was "button"
#define beam 9
#define reset 10

// set some global variables
int timerMode =0;
long startTime;

// screen pin configuration
LiquidCrystal lcd(1, 2, 4, 5, 6, 7);
//-------------------------------------------






// setup - runs only once when first powered up
//---------------------------------------------
void setup(){

  lcd.begin(16,2);
  pinMode(gate, INPUT_PULLUP);
  pinMode(beam, INPUT_PULLUP);
  pinMode(reset, INPUT_PULLUP);
  lcd.clear();
  lcd.setCursor(0,0);
  lcd.print("Ready for a run ");
  
  }
//---------------------------------------------  
  
  
  
// main loop
//---------------------------------------------
  // --- TOP
  void loop(){
  
	while(digitalRead(gate)== HIGH){} // do nothing - untill gate opened (=low)
	
// --- gate opened (=low) --> GO GO GO
	startTime = millis();
	timerMode++; // timerMode =1
	
// timer running
	lcd.setCursor(0,0);
	lcd.print("Run in progress ");
	
// ---run loop
	while(timerMode ==1){
	  lcd.setCursor(0,1);
	  lcd.print((millis()-startTime)/1000.0);
	  //check beam 
	  if (digitalRead(beam)==LOW){ // beam broken - stop timing
	    timerMode =0;
		} // end of if statement
	} // end of timer running while loop
	
	
// --- timing finished
  // reset button check
	lcd.setCursor(0,0);
	lcd.print("Press reset     ");
	while(digitalRead(reset)==HIGH){} //do nothing - untill reset pressed (low)

  // gate Switch check
	lcd.setCursor(0,0);
	lcd.print("Gate Open !     ");
	while(digitalRead(gate)==LOW){} // do nothing - while gate open
	lcd.setCursor(0,0);
	lcd.print("Beam cut !      ");
	
  // beam broken check
	while(digitalRead(beam)==LOW){} // do nothing - while beam is cut 
	lcd.clear();
	lcd.setCursor(0,0);
	lcd.print("Ready for a Run ");
	
// end of main loop - goto top
} 